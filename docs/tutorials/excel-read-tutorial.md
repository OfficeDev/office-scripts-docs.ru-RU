---
title: Чтение данных книги с помощью сценариев Office в Excel в Интернете
description: Учебник по сценариям Office о чтении данных из книг и их оценке в сценарии.
ms.date: 01/06/2021
ms.localizationpriority: high
ms.openlocfilehash: 739ad5bd1fa395c5081442246241cd598ce7c39c
ms.sourcegitcommit: d3ed4bdeeba805d97c930394e172e8306a0cf484
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2021
ms.locfileid: "59335905"
---
# <a name="read-workbook-data-with-office-scripts-in-excel-on-the-web"></a>Чтение данных книги с помощью сценариев Office в Excel в Интернете

В этом учебнике объясняется, как читать данные из книги с помощью сценария Office для Excel в Интернете. Вы напишите новый сценарий, форматирующий банковскую выписку и нормализующий данные в ней. В рамках этой очистки данных ваш сценарий будет считывать значения из ячеек транзакций, применять простую формулу к каждому значению и записывать полученный ответ в книгу. Чтение данных из книги позволяет вам автоматизировать некоторые процессы принятия решений в сценарии.

> [!TIP]
> Если вы только приступили к работе со сценариями Office, рекомендуем начать с учебника [Запись, редактирование и создание сценариев Office в Excel в Интернете](excel-tutorial.md). [Сценарии Office используют TypeScript](../overview/code-editor-environment.md), и этот учебник предназначен для пользователей с начальным и средним уровнем знаний по JavaScript или TypeScript. Если вы впервые работаете с JavaScript, рекомендуем начать с [учебника Mozilla по JavaScript](https://developer.mozilla.org/docs/Web/JavaScript/Guide/Introduction).

## <a name="prerequisites"></a>Предварительные условия

[!INCLUDE [Tutorial prerequisites](../includes/tutorial-prerequisites.md)]

## <a name="read-a-cell"></a>Чтение ячейки

Сценарии, созданные с помощью средства записи действий, могут только записывать информацию в книгу. С помощью редактора кода можно редактировать и создавать сценарии, которые также читают данные из книги.

Давайте создадим сценарий, читающий данные и действующий на основе прочитанного. Мы будем работать с примером банковской выписки. Эта выписка объединяет чековую выписку и выписку по кредиту. К сожалению, изменения баланса в них указываются по-разному. В чековой выписке доходы указываются как положительный кредит, а расходы — в виде отрицательного дебета. В выписке по кредиту все наоборот.

В остальной части учебника мы нормализуем эти данные с помощью сценария. Сначала научимся читать данные из книги.

1. Создайте лист в книге, которую вы использовали в остальной части учебника.
2. Скопируйте следующие данные и вставьте их на новый лист, начиная с ячейки **A1**.

    |Дата |Счет |Описание |Дебет |Кредит |
    |:--|:--|:--|:--|:--|
    |10.10.2019 |Чековый |Виноградник Coho |–20,05 | |
    |11.10.2019 |Кредитный |Телефонная компания |99,95 | |
    |13.10.2019 |Кредитный |Виноградник Coho |154,43 | |
    |15.10.2019 |Чековый |Внешний депозит | |1000 |
    |20.10.2019 |Кредитный |Виноградник Coho — возмещение | |–35,45 |
    |25.10.2019 |Чековый |Органическая компания "Лучшее для вас" | –85,64 | |
    |01.11.2019 |Чековый |Внешний депозит | |1000 |

3. Откройте **Все сценарии** и выберите **Создать сценарий**.
4. Давайте очистим форматирование. Это финансовый документ, поэтому изменим числовой формат в столбцах **Дебет** и **Кредит**, чтобы отобразить значения в долларах. Также настроим ширину столбца по данным.

    Замените содержимое сценария следующим кодом:

    ```TypeScript
    function main(workbook: ExcelScript.Workbook) {
        // Get the current worksheet.
        let selectedSheet = workbook.getActiveWorksheet();

        // Format the range to display numerical dollar amounts.
        selectedSheet.getRange("D2:E8").setNumberFormat("$#,##0.00");

        // Fit the width of all the used columns to the data.
        selectedSheet.getUsedRange().getFormat().autofitColumns();
    }
    ```

5. Теперь прочитаем значение в одном из числовых столбцов. Добавьте следующий код в конце сценария (перед закрывающей скобкой `}`):

    ```TypeScript
    // Get the value of cell D2.
    let range = selectedSheet.getRange("D2");
    console.log(range.getValues());
    ```

6. Запустите сценарий.
7. В консоли должно отображаться следующее: `[Array[1]]`. Это не число, так как диапазоны являются двухмерными массивами данных. Этот двухмерный диапазон напрямую регистрируется в консоли. К счастью, редактор кода позволяет просмотреть содержимое массива.
8. Когда двухмерный массив регистрируется в консоли, она группирует значения столбцов под каждой строкой. Разверните журнал массива, выбрав синий треугольник.
9. Разверните второй уровень массива, выбрав появившийся синий треугольник. Вот что вы увидите теперь:

    :::image type="content" source="../images/tutorial-4.png" alt-text="Журнал консоли, отображающий результат &quot;–20,05&quot;, размещенный под двумя массивами.":::

## <a name="modify-the-value-of-a-cell"></a>Изменение значения ячейки

Теперь, когда мы можем читать данные, воспользуемся ими, чтобы изменить книгу. Мы сделаем значение ячейки **D2** положительным с помощью функции `Math.abs`. Объект [Math](https://developer.mozilla.org/docs/web/javascript/reference/global_objects/math) содержит множество функций, к которым имеют доступ сценарии. Дополнительные сведения о `Math` и других встроенных объектах можно найти в статье [Использование встроенных объектов JavaScript в сценариях Office](../develop/javascript-objects.md).

1. Мы будем использовать методы `getValue` и `setValue`, чтобы изменить значение ячейки. Эти методы применимы к одной ячейке. При обработке диапазонов, включающих несколько ячеек, нужно использовать `getValues` и `setValues`. Добавьте следующий код в конце сценария:

    ```TypeScript
    // Run the `Math.abs` function with the value at D2 and apply that value back to D2.
    let positiveValue = Math.abs(range.getValue() as number);
    range.setValue(positiveValue);
    ```

    > [!NOTE]
    > Мы [приводим](https://www.typescripttutorial.net/typescript-tutorial/type-casting/) возвращаемое значение `range.getValue()` к `number`, используя ключевое слово `as`. Это необходимо, так как диапазон может включать строки, числа или логические значения. В данном случае нам явно нужно число.

2. Значение ячейки **D2** теперь должно быть положительным.

## <a name="modify-the-values-of-a-column"></a>Изменение значений столбца

Теперь, когда вы знаете, как читать и записывать данные в одной ячейке, давайте обобщим сценарий для работы со всеми столбцами **Дебет** и **Кредит**.

1. Удалите код, влияющий только на одну ячейку (предыдущий код с абсолютным значением), чтобы ваш сценарий выглядел следующим образом:

    ```TypeScript
    function main(workbook: ExcelScript.Workbook) {
        // Get the current worksheet.
        let selectedSheet = workbook.getActiveWorksheet();

        // Format the range to display numerical dollar amounts.
        selectedSheet.getRange("D2:E8").setNumberFormat("$#,##0.00");

        // Fit the width of all the used columns to the data.
        selectedSheet.getUsedRange().getFormat().autofitColumns();
    }
    ```

2. Добавьте цикл в конце сценария, выполняющий итерацию в строках двух последних столбцов. Для каждой ячейки сценарий устанавливает текущее абсолютное значение.

    Обратите внимание, что массив, определяющий расположения ячеек, отсчитывается от нуля. Это означает, что ячейка **A1** имеет значение `range[0][0]`.

    ```TypeScript
    // Get the values of the used range.
    let range = selectedSheet.getUsedRange();
    let rangeValues = range.getValues();

    // Iterate over the fourth and fifth columns and set their values to their absolute value.
    let rowCount = range.getRowCount();
    for (let i = 1; i < rowCount; i++) {
        // The column at index 3 is column "4" in the worksheet.
        if (rangeValues[i][3] != 0) {
            let positiveValue = Math.abs(rangeValues[i][3] as number);
            selectedSheet.getCell(i, 3).setValue(positiveValue);
        }

        // The column at index 4 is column "5" in the worksheet.
        if (rangeValues[i][4] != 0) {
            let positiveValue = Math.abs(rangeValues[i][4] as number);
            selectedSheet.getCell(i, 4).setValue(positiveValue);
        }
    }
    ```

    Эта часть сценария выполняет несколько важных задач. Сначала она получает значения и количество строк используемого диапазона. Это позволяет просматривать значения и определять момент остановки. Затем выполняется итерация в используемом диапазоне с проверкой каждой ячейки в столбцах **Дебет** или **Кредит**. Наконец, если значение в ячейке не равно 0, оно заменяется абсолютным значением. Мы избегаем использования нулей, поэтому можно оставить пустые ячейки неизменными.

3. Запустите сценарий.

    Теперь банковская выписка должна выглядеть следующим образом:

    :::image type="content" source="../images/tutorial-5.png" alt-text="Таблица, показывающая банковскую выписку в виде отформатированной таблицы только с положительными значениями.":::

## <a name="next-steps"></a>Дальнейшие действия

Откройте редактор кода и попробуйте некоторые [примеры сценариев Office в Excel в Интернете](../resources/samples/excel-samples.md). Дополнительные сведения о создании сценариев Office доступны в статье [Основные сведения о сценариях Office в Excel в Интернете](../develop/scripting-fundamentals.md).

В следующем наборе учебников по сценариям Office рассматривается использование сценариев Office с помощью Power Automate. Узнайте больше о преимуществах сочетания двух платформ в статье [Выполнение сценариев Office с помощью Power Automate](../develop/power-automate-integration.md) или ознакомьтесь с учебником [Вызов сценариев из активированного вручную потока Power Automate](excel-power-automate-manual.md), чтобы создать поток Power Automate, использующий сценарий Office.

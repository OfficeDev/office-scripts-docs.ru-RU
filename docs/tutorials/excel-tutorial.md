---
title: Запись, редактирование и создание сценариев Office в Excel в Интернете
description: Учебник с основными сведениями о сценариях Office, включая запись сценариев с помощью средства записи действий и запись данных в книгу.
ms.date: 01/27/2020
localization_priority: Priority
ms.openlocfilehash: 1971ff2ffd80554beb6ac561677ee3384f87ca81
ms.sourcegitcommit: b075eed5a6f275274fbbf6d62633219eac416f26
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2020
ms.locfileid: "42700312"
---
# <a name="record-edit-and-create-office-scripts-in-excel-on-the-web"></a>Запись, редактирование и создание сценариев Office в Excel в Интернете

В этом учебнике вы ознакомитесь с основами записи, редактирования и создания сценария Office для Excel в Интернете.

## <a name="prerequisites"></a>Необходимые компоненты

[!INCLUDE [Preview note](../includes/preview-note.md)]

Перед началом работы с этим учебником у вас должен быть доступ к сценариям Office. Для этого требуется следующее:

- [Excel в Интернете](https://www.office.com/launch/excel).
- Попросите своего администратора [включить сценарии Office для организации](https://support.office.com/article/office-scripts-settings-in-m365-19d3c51a-6ca2-40ab-978d-60fa49554dcf), в результате чего на ленту добавится вкладка **Автоматизировать**.

> [!IMPORTANT]
> Этот учебник предназначен для пользователей с начальным и средним уровнем знаний по JavaScript или TypeScript. Если вы впервые работаете с JavaScript, рекомендуем прочесть [учебник Mozilla по JavaScript](https://developer.mozilla.org/docs/Web/JavaScript/Guide/Introduction). Чтобы получить дополнительные сведения о среде сценариев, ознакомьтесь со статьей [Сценарии Office в Excel в Интернете](../overview/excel.md).

## <a name="add-data-and-record-a-basic-script"></a>Добавление данных и запись простого сценария

Сначала нам потребуются некоторые данные и небольшой начальный сценарий.

1. Создайте книгу в Excel в Интернете.
2. Скопируйте следующие данные о продаже фруктов и вставьте их на лист, начиная с ячейки **A1**.

    |Фрукты |2018 |2019 |
    |:---|:---|:---|
    |Апельсины |1000 |1200 |
    |Лимоны |800 |900 |
    |Лаймы |600 |500 |
    |Грейпфруты |900 |700 |

3. Откройте вкладку **Автоматизировать**. Если вы не видите вкладку **Автоматизировать**, проверьте переполнение ленты, нажав стрелку раскрывающегося списка.
4. Нажмите кнопку **Записать действия**.
5. Выделите ячейки **A2:C2** (строка "Апельсины") и установите оранжевый цвет заливки.
6. Чтобы остановить запись, нажмите кнопку **Остановить**.
7. Введите в поле **Имя сценария** запоминающееся имя.
8. *Необязательно.* Введите в поле **Описание** понятное описание. Оно используется для предоставления контекста в отношении действий сценария. Для этого учебника можно использовать описание "Цветовая кодировка строк таблицы".

   > [!TIP]
   > Вы можете изменить описание сценария позже в области **Сведения о сценарии**, расположенной в меню **...** редактора кода.

9. Сохраните сценарий, нажав кнопку **Сохранить**.

    Ваш лист должен выглядеть, как показано ниже (не волнуйтесь, если цвет отличается):

    ![Строка данных о продажах фруктов с выделенной оранжевым цветом строкой "Апельсины".](../images/tutorial-1.png)

## <a name="edit-an-existing-script"></a>Редактирование существующего сценария

Предыдущий сценарий окрасил строку "Апельсины" в оранжевый цвет. Давайте добавим желтый цвет для строки "Лимоны".

1. Откройте вкладку **Автоматизировать**.
2. Нажмите кнопку **Редактор кода**.
3. Откройте сценарий, записанный в предыдущем разделе. Должен отобразится примерно такой код:

    ```TypeScript
    async function main(context: Excel.RequestContext) {
      // Set fill color to FFC000 for range Sheet1!A2:C2
      let workbook = context.workbook;
      let worksheets = workbook.worksheets;
      let selectedSheet = worksheets.getActiveWorksheet();
      selectedSheet.getRange("A2:C2").format.fill.color = "FFC000";
    }
    ```

    Этот код получает текущий лист, сначала обращаясь к коллекции листов книги. Затем он настраивает цвет заливки диапазона **A2:C2**.

    Диапазоны — это фундаментальная часть сценариев Office в Excel в Интернете. Диапазон — это непрерывный прямоугольный блок ячеек, содержащий значения, формулы и форматирование. Они представляют собой базовую структуру ячеек, в которой можно выполнять большинство задач сценариев.

4. Добавьте следующую строку в конце сценария (между местом настройки значения `color` и закрывающей скобкой `}`):

    ```TypeScript
    selectedSheet.getRange("A3:C3").format.fill.color = "yellow";
    ```

5. Протестируйте сценарий, нажав **Запустить**. Книга должна выглядеть следующим образом:

    ![Строка данных о продажах фруктов с выделенной оранжевым цветом строкой "Апельсины" и выделенной желтым цветом строкой "Лимоны".](../images/tutorial-2.png)

## <a name="create-a-table"></a>Создание таблицы

Давайте преобразуем эти данные продаж фруктов в таблицу. Мы воспользуемся собственным сценарием для всего процесса.

1. Добавьте следующую строку в конце сценария (перед закрывающей скобкой `}`):

    ```TypeScript
    let table = selectedSheet.tables.add("A1:C5", true);
    ```

2. Этот вызов возвращает объект `Table`. Воспользуемся этой таблицей, чтобы отсортировать данные. Отсортируем данные по возрастанию на основе значений в столбце "Фрукты". Добавьте следующую строку после создания таблицы:

    ```TypeScript
    table.sort.apply([{ key: 0, ascending: true }]);
    ```

    Ваш сценарий должен выглядеть так:

    ```TypeScript
    async function main(context: Excel.RequestContext) {
      // Set fill color to FFC000 for range Sheet1!A2:C2
      let workbook = context.workbook;
      let worksheets = workbook.worksheets;
      let selectedSheet = worksheets.getActiveWorksheet();
      selectedSheet.getRange("A2:C2").format.fill.color = "FFC000";
      selectedSheet.getRange("A3:C3").format.fill.color = "yellow";
      let table = selectedSheet.tables.add("A1:C5", true);
      table.sort.apply([{ key: 0, ascending: true }]);
    }
    ```

    В таблицах есть объект `TableSort`, доступный с помощью свойства `Table.sort`. Вы можете применить условия сортировки к этому объекту. Метод `apply` использует массив объектов `SortField`. В этом случае у нас есть только одно условие сортировки, поэтому мы используем только один параметр `SortField`. `key: 0` присваивает столбцу со значениями, определяющими сортировку, значение "0" (это первый столбец в таблице, в данном случае: **A**). `ascending: true` сортирует данные по возрастанию (вместо порядка по убыванию).

3. Запустите сценарий. Вы увидите следующую таблицу:

    ![Отсортированная таблица продаж фруктов.](../images/tutorial-3.png)

    > [!NOTE]
    > При повторном запуске сценария возникнет ошибка. Это связано с тем, что вы не можете создать таблицу поверх другой таблицы. Однако вы можете запустить этот сценарий на другом листе или в другой книге.

### <a name="re-run-the-script"></a>Повторный запуск сценария

1. Создайте лист в текущей книге.
2. Скопируйте данные фруктов из начала учебника и вставьте их на новый лист, начиная с ячейки **A1**.
3. Запустите сценарий.

## <a name="next-steps"></a>Дальнейшие действия

Выполните инструкции учебника [Чтение данных книги с помощью сценариев Office в Excel в Интернете](excel-read-tutorial.md). С его помощью вы научитесь читать данные из книги с помощью сценариев Office.
